<% content_for(:title, "@#{@post.title}") %>
<% breadcrumb :post_show, @post, @area_tags, @genre_tags, @taste_tags, @outher_tags, @user, @playlist, @post_path %>
<%# パンくずリスト呼ぶとき選択したタグ情報を保持する %>

<div class="container">
<div class="row">
<%= @post.title %>
</div>

<div class="row">
<% @post.area_tags.each do |area_tag| %>
<%= area_tag.name %>
<% end %>
<% @post.genre_tags.each do |genre_tag| %>
<%= genre_tag.name %>
<% end %>
<% @post.taste_tags.each do |taste_tag| %>
<%= taste_tag.name %>
<% end %>
<% @post.outher_tags.each do |outher_tag| %>
<%= outher_tag.name %>
<% end %>
</div>

<div class="row d-flex">
<span><%= t(".posted_by") %> <%= link_to @posted_user.name, user_path(@posted_user) %></span>
</div>

<div class="row">
<% if @post.source.present? %>
<%= t(".source") %> <%= @post.source %>
<% end %>
</div>

<div class="row">
<% if @post.store_url.present? %>
<%= t(".store_url") %> <%= @post.store_url %>
<% end %>
</div>

<%# -----------------------画像関連-------------------------- %>

<div class="d-flex justify-content-center">

<div class="row mb-2">
<% if @post.main_image.attached? %>
  <%= image_tag @post.main_image.variant(resize_to_fit: [600, 600]) %>
<% end %>
</div>

</div>


<div class="d-flex justify-content-center align-items-start">

<div class="row">
  <% if @post.sub_image_first.attached? %>
    <%= image_tag @post.sub_image_first.variant(resize_to_fit: [400, 400]) %>
  <% end %>
</div>

<div class="col-1">
</div>

<div class="row">
  <% if @post.sub_image_second.attached? %>
    <%= image_tag @post.sub_image_second.variant(resize_to_fit: [400, 400]) %>
  <% end %>
</div>

</div>

<div class="row">
<%= @post.dish.description %>
</div>


<%# --------------------プレイリスト関連--------------------- %>

<% if logged_in? %>
<div class="col-2">
<button type="button" class="btn btn-primary mb-12 btn-sm" data-toggle="modal" data-target="#playlist">プレイリストへ追加</button>
</div>

<div class="modal fade" id="playlist" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4><div class="modal-title" id="myModalLabel">@プレイリストへ追加</h4>
      </div>

      <div class="modal-body">
      <%= form_with(url: add_to_playlist_post_path(@post), method: :post) do %>
        <%= label_tag :playlist_id, "@作成済みのプレイリストを選択" %>
        <%= select_tag :playlist_id, options_from_collection_for_select(@user_playlists, :id, :title), include_blank: true %>
        <%= submit_tag "選択" %>
      <% end %>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">@閉じる</button>
      </div>

    </div>
  </div>
</div>
<% end %>


<%# -------------いいね機能関連---------------------- %>

<% if logged_in? && @post.user_id != current_user.id %>
  <% if current_user.like_include?(@post) %>

    <%= link_to post_like_path(@post), id: "bad-#{@post.id}", data: { turbo_method: :delete } do %>
      <i class="bi bi-hand-thumbs-up-fill"></i>
    <% end %>

  <% else %>

    <%= link_to post_likes_path(post_id: @post.id), id: "good-#{@post.id}", data: { turbo_method: :post } do %>
      <i class="bi bi-hand-thumbs-up"></i>
    <% end %>


  <% end %>
<% end %>


<%# ------------コメント関連------------ %>
<div class="row mt-3 p-2 bg-primary-subtle" id="comment-form">
  <%= form_with model: @comment, url: post_comments_path(@post) do |f| %>
    <%= render 'shared/error_messages', object: f.object %>

    <%= f.label :body %>
    <%= f.text_area :body, class: "form-control mb-3" %>
    <%= f.submit nil, class: "btn btn-primary" %>
  <% end %>
</div>





<%# -------------コメント全部（途中）-------------- %>
<%= turbo_frame_tag "all_comments" do %>
  <% @post_comments.each do |comment| %>
    <div class="row mt-3 p-2 bg-danger" id="comment-<%= comment.id %>">
      <div class="d-flex justify-content-between">
        <div class="d-flex flex-row">
          <p><%= t(".whose_comment", user_name: comment.user.name) %></p>
          <%= link_to "編集", edit_comment_path(comment) %>
          <%= link_to "削除", comment_path(comment), data: { turbo_method: :delete, turbo_confirm: "@本当に削除しますか？" } %>
        </div>
        <p><%= comment.updated_at.strftime("%Y/%m/%d %H:%M:%S") %></p>
      </div>

      <p><%= comment.body %></p>
    </div>
  <% end %>
<% end %>


</div> 
<%# 4行のcontainer %>